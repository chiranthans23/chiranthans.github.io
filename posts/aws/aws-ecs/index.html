<!doctype html><html><head><title>AWS ECS</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/navigators/navbar.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/sections/site/chiras-logo_hu9df99441f87e520e7225acd2f20deded_27031_42x0_resize_box_2.png><link rel=stylesheet href=/css/style.css><meta name=description content="AWS ECS"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/sections/site/chiras-logo_hu9df99441f87e520e7225acd2f20deded_27031_42x0_resize_box_2.png>Chiranthan's Blog</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/sections/site/chiras-logo_hu9df99441f87e520e7225acd2f20deded_27031_42x0_resize_box_2.png class=d-none id=main-logo>
<img src=/images/sections/site/chiras-logo_hu9df99441f87e520e7225acd2f20deded_27031_42x0_resize_box_2.png class=d-none id=inverted-logo></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><input type=text placeholder=Search data-search id=search-box><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/aws/>AWS</a><ul class=active><li><a href=/posts/aws/aws-cm/>AWS Certificate Manager</a></li><li><a href=/posts/aws/aws-cloudfront/>AWS Cloudfront</a></li><li><a href=/posts/aws/aws-dynamodb/>AWS DynamoDB</a></li><li><a class=active href=/posts/aws/aws-ecs/>AWS ECS</a></li><li><a href=/posts/aws/aws-eks/>AWS EKS</a></li><li><a href=/posts/aws/aws-route53/>AWS Route53</a></li><li><a href=/posts/aws/aws-s3/>AWS S3</a></li><li><a href=/posts/aws/aws-sns-sqs/>AWS SNS and SQS</a></li><li><a href=/posts/aws/aws-vpc/>AWS VPC Fundamentals</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/general/>General</a><ul><li><a href=/posts/general/stay-strong/>Staying strong in life</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://blog.chiranthans23.com/posts/aws/aws-ecs/hero.png)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/sections/site/chiras-picture.png><h5 class=author-name>Chiranthan S</h5><p>March 3, 2021</p></div><div class=title><h1>AWS ECS</h1></div><div class=post-content id=post-content><h1 id=amazon-ecs>Amazon ECS</h1><h2 id=overview>Overview</h2><ul><li>ECS clusters are logical grouping of EC2 instances</li><li>EC2 instances run the ECS agent(Docker container)</li><li>ECS agents registers the instance to ECS cluster</li><li>EC2 instances run a special AMI made specifically for ECS</li></ul><h2 id=creating-a-ecs-cluster>Creating a ECS cluster</h2><ul><li>Management console-> ECS</li><li>Create cluster- providing details like the instance size, VPC and subnet details, security group details and so on</li><li>We can see the ECS details, auto scaling groups, launch configuration and so on</li><li>If we had enabled ssh to ec2 instance, we can ssh and see in the docker logs that ec2 instance will be registering itself to ecs cluster that we created</li></ul><h2 id=ecs-task-definitions>ECS task definitions</h2><ul><li>It is metadata in JSON form that tells ECS how to run a Docker container</li><li>It contains following information:<ul><li>Image name</li><li>Port binding of container and host</li><li>Memory and CPU required</li><li>Env variables</li><li>Networking information</li><li>etc</li></ul></li></ul><h2 id=creating-an-ecs-task-definition>Creating an ECS task definition</h2><ul><li>Go to ECS -> task definition -> create task definition</li><li>Reserve memory and CPU size</li><li>Provide the image+tag name</li><li>Add container</li><li>Set the hard, soft limit for the memory</li><li>Port mapping , volume mapping, etc</li><li>We can also see the task definition in JSON form as well</li></ul><h2 id=creating-an-ecs-service>Creating an ECS service</h2><ul><li>It helps in defining how the tasks should be run and number of tasks should run</li><li>ECS clusters-> cluster-> create service</li><li>Choose the task, cluster, etc and create the service</li><li>This should start running the task and can be visualised through docker logs in the host</li><li>We can also scale the number of tasks to be run( if the port is reserved for a task, we need to scale instance number in auto scaling group too)</li></ul><h2 id=ecs-service-with-lb>ECS service with LB</h2><ul><li>We can have multiple instances running tasks and a load balancer can be used to stream the traffic among them</li><li>Note: A service can&rsquo;t be edited to add load balancer, so a new service should be created with a load balancer attached to it</li><li>Create a load balancer with appropriate vpc, subnets, security group and set the target group(set of instances)</li><li>Now create a service in the cluster with an ALB attached.</li><li>Allow security group of the cluster to have an inbound rule from ALB, with this we should be able to make call from ALB&rsquo;s DNS name</li></ul><h2 id=ecr>ECR</h2><ul><li>We can use AWS&rsquo;s own image repository for storing and retreiving images</li><li>It can be made public or private</li><li>In ECS-> ECR-> Create repository and name it</li><li>Follow the instructions given to push your name from local</li></ul><h2 id=using-our-ecr-image>Using our ECR image</h2><ul><li>We can update our task to new revision and provide our image URL</li><li>If we update our service with new revision, tasks in instances should restart with our image</li></ul><h2 id=aws-fargate>AWS Fargate</h2><ul><li>This is a way of having ECS cluster without using EC2 instances</li><li>It&rsquo;s managed by AWS</li><li>We just have to increase and decrease our tasks, as needed</li></ul><h2 id=creating-ecs-cluster-with-fargate-and-more>Creating ECS cluster with Fargate and more</h2><ul><li>ECS cluster-> create cluster using Fargate</li><li>Now create a task with type Fargate</li><li>Note: Port mapping is not necessary in this case, it does on it&rsquo;s own, just the container exposed port should be given</li><li>Create a service with task created, assign a load balancer, target group, vpc and sec group</li><li>ECS cluster is ready</li></ul><h2 id=placement-strategy>Placement strategy</h2><ul><li>The way in which an EC2 task is placed on an instance with constraints of CPU, memory, available port</li><li>Task placement strategy and task placement constraint helps us with this</li><li>Note: This is only for EC2 type cluster</li><li>Process taken by ECS to place task on an instance:<ul><li>Idenity instances that satisify memory, cpu and port constraints</li><li>Find the instances that pass placement constraint</li><li>Find the instances that pass placement strategy</li><li>place the task</li></ul></li></ul><h2 id=types-of-placement-strategy>Types of placement strategy</h2><ol><li><p>Binpack</p><ul><li>Minimizes the cost as it chooses based on least amount of memory or CPU available(so less number of instances)</li></ul></li><li><p>Random</p><ul><li>Place tasks randomly to instances</li></ul></li><li><p>Spread on AZ</p><ul><li>Spreads tasks evenly on all AZs</li></ul></li><li><p>Mix of them</p><ul><li>Combinations like (spread on AZ, binpack) and (spread on AZ, spread on instances) are possible too</li></ul></li></ol><h2 id=types-of-placement-constraints>Types of placement constraints</h2><ol><li><p>DistinctInstance</p><ul><li>Tasks <em>must</em> be placed on distinct instances</li></ul></li><li><p>Member of</p><ul><li>An expression can be used to check if an instance belongs to that category. e.g, size of the instance is <em>micro</em>? and so on</li></ul></li></ol><h2 id=applying-constraints-and-strategy>Applying constraints and strategy</h2><ul><li>ECS-> cluster-> create service-> placement strategy</li></ul><h2 id=ecr-pricing>ECR pricing</h2><ul><li><a href=https://aws.amazon.com/ecr/pricing/>https://aws.amazon.com/ecr/pricing/</a></li></ul><h2 id=image-policy-in-ecr>Image policy in ECR</h2><ul><li>We can delete Images in ECR based on the criteria of number of days elapsed after the image is pushed</li></ul></div><div class=btn-improve-page><a href=https://github.com/chiranthans23/chiranthans23.github.io/edit/master/content/posts/aws/aws-ecs/index.md><i class="fas fa-code-branch"></i>Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/aws/aws-sns-sqs/ class="btn btn-outline-info"><span><i class="fas fa-chevron-circle-left"></i>Prev</span><br><span>AWS SNS and SQS</span></a></div><div class="col-md-6 next-article"><a href=/posts/aws/aws-eks/ class="btn btn-outline-info"><span>Next <i class="fas fa-chevron-circle-right"></i></span><br><span>AWS EKS</span></a></div></div><hr></div></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#creating-a-ecs-cluster>Creating a ECS cluster</a></li><li><a href=#ecs-task-definitions>ECS task definitions</a></li><li><a href=#creating-an-ecs-task-definition>Creating an ECS task definition</a></li><li><a href=#creating-an-ecs-service>Creating an ECS service</a></li><li><a href=#ecs-service-with-lb>ECS service with LB</a></li><li><a href=#ecr>ECR</a></li><li><a href=#using-our-ecr-image>Using our ECR image</a></li><li><a href=#aws-fargate>AWS Fargate</a></li><li><a href=#creating-ecs-cluster-with-fargate-and-more>Creating ECS cluster with Fargate and more</a></li><li><a href=#placement-strategy>Placement strategy</a></li><li><a href=#types-of-placement-strategy>Types of placement strategy</a></li><li><a href=#types-of-placement-constraints>Types of placement constraints</a></li><li><a href=#applying-constraints-and-strategy>Applying constraints and strategy</a></li><li><a href=#ecr-pricing>ECR pricing</a></li><li><a href=#image-policy-in-ecr>Image policy in ECR</a></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=#about>About</a></li><li class=nav-item><a class=smooth-scroll href=#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=#projects>Projects</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>chiranthans23@gmail.com</span></li><li><span>Phone:</span> <span>+919535179196</span></li></ul></div></div></div><hr></footer><script src=/js/jquery-3.4.1.min.js></script><script src=/js/popper.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/navbar.js></script><script src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>