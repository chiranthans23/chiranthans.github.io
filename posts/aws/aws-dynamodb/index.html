<!doctype html><html><head><title>AWS DynamoDB</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/navigators/navbar.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/sections/site/chiras-logo_hue4b36852387f98c20424375628d7006b_59865_42x0_resize_box_2.png><link rel=stylesheet href=/css/style.css><meta name=description content="AWS DynamoDB"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/sections/site/chiras-logo_hue4b36852387f98c20424375628d7006b_59865_42x0_resize_box_2.png>Chiranthan's Blog</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/sections/site/chiras-logo_hue4b36852387f98c20424375628d7006b_59865_42x0_resize_box_2.png class=d-none id=main-logo>
<img src=/images/sections/site/chiras-logo_hue4b36852387f98c20424375628d7006b_59865_42x0_resize_box_2.png class=d-none id=inverted-logo></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><input type=text placeholder=Search id=search-box><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/posts/ai/>AI</a><ul><li><a href=/posts/ai/stress-analysis-social-media/>Stress analysis on Social media</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/aws/>AWS</a><ul class=active><li><a href=/posts/aws/aws-cm/>AWS Certificate Manager</a></li><li><a href=/posts/aws/aws-cloudfront/>AWS Cloudfront</a></li><li><a class=active href=/posts/aws/aws-dynamodb/>AWS DynamoDB</a></li><li><a href=/posts/aws/aws-ecs/>AWS ECS</a></li><li><a href=/posts/aws/aws-eks/>AWS EKS</a></li><li><a href=/posts/aws/aws-route53/>AWS Route53</a></li><li><a href=/posts/aws/aws-s3/>AWS S3</a></li><li><a href=/posts/aws/aws-sns-sqs/>AWS SNS and SQS</a></li><li><a href=/posts/aws/aws-vpc/>AWS VPC Fundamentals</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/general/>General</a><ul><li><a href=/posts/general/stay-strong/>Staying strong in life</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://blog.chiranthans23.com/posts/aws/aws-dynamodb/hero.png)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/sections/site/chiras-picture.png><h5 class=author-name>Chiranthan S</h5><p>March 12, 2021</p></div><div class=title><h1>AWS DynamoDB</h1></div><div class=post-content id=post-content><h1 id=aws-dynamodb>AWS DynamoDB</h1><h2 id=overview>Overview</h2><ul><li>Fully managed, highly available and has 3 AZ</li><li>Integrated with IAM</li><li>Max size of an item is 400KB</li></ul><h2 id=primary-key>Primary key</h2><ol><li>Partition key</li><li>Partition key+ Sort key</li></ol><h2 id=rcu-and-wcu-throughput>RCU and WCU throughput</h2><ul><li><p>RCU- Read capacity units- throughput for reads</p></li><li><p>WCU- Write capacity units- throughput for writes</p></li><li><p>Option to setup auto-scaling to meet the demands</p></li><li><p>Usig <em>burst credit</em> throughput can be exceeded</p></li><li><p>If <em>burst credit</em> is empty, ProvisionedThroughputException is thrown</p></li><li><p>Strongly consistent read:</p><ul><li>When a read operation is performed after a write, updated item is returned</li></ul></li><li><p>Eventually consistent read:</p><ul><li>When a read operation is perfomed after write, it&rsquo;s possible to get old data, because of replication</li></ul></li><li><p>By default DDB uses eventually consistent read. But, GetItem, Query and Scan provide option to set ConsistentRead to true</p></li><li><p>WCU:</p><ul><li>One WCU represents 1 write per second for an item up to 1KB size</li></ul></li><li><p>RCU:</p><ul><li>One RCU represents 1 strongly consisted read per second or two eventually consisted read per second for an item up to size 4KB</li></ul></li></ul><h2 id=dynamodb-basic-apis>DynamoDB basic APIs</h2><ul><li><p>Write data</p><ul><li>PutItem- Writes to DynamoDB or replaces fully</li><li>UpdateItem- partial update of attributes</li><li>ConditionalWrites- Accept a write only if conditions are met. Helps with concurrent access to items</li></ul></li><li><p>Delete data</p><ul><li>DeleteItem- Delete an individual row, can also delete based on condition</li><li>DeleteTable- Deltes a whole table. Quicker than DeleteItem for all items</li></ul></li><li><p>BatchingWriteItem</p><ul><li>Upto 25 PutItem/DeleteItem in one call</li><li>Upto 16MB of data writeen/ 400KB of data per item</li><li>Saves latency by reducing the number of calls</li><li>Operations done in parallel</li><li>Possibility of part of batch items operation to fail, in which case, we&rsquo;ve to retry</li></ul></li><li><p>Reading data</p><ul><li>GetItem- Reading based on primary key. By default uses <code>eventually consistent read</code>, but <code>strongly consistent read</code> can be used too. <code>ProjectExpression</code> can be specified to include only certain attributes</li><li>BatchGetItem- Upto 100 items can be read, upto 16MB of data, read in parallel to reduce latency</li></ul></li><li><p>Query</p><ul><li>Based on partition key</li><li>Sort key can be used too</li><li>FilterExpression can be done too, at the client side</li><li>Upto 1MB of data can be returned or the number of items, as specified</li><li>Pagination can be done</li></ul></li></ul><h2 id=gsi-and-lsi-in-dynamodb>GSI and LSI in DynamoDB</h2><ul><li><p>LSI</p><ul><li>Alternate ranging key(sort key) for the table</li><li>We can have upto 5 LSIs per table</li><li>The attribute can be String, Number or Boolean</li><li>Must be defined at the time of creation</li></ul></li><li><p>GSI</p><ul><li>Helps in speeding up queries on non-key attributes</li><li>GSI= paritionkey+optional sortkey</li><li>Index is a new table, we can project attributes on it<ul><li>Partition and sort keys of original table are always projected(KEYS_ONLY)</li><li>Specific attributes projected(INCLUDE)</li><li>All attributes projected(ALL)</li></ul></li><li>We must define RCU and WCU for the index</li><li>We can modify GSI, but not LSI</li></ul></li><li><p>Throttling</p><ul><li><p>GSI</p><ul><li>The main table will be affected if the GSI write is throttled</li><li>WCU and partition key for GSI should be choosed wisely</li><li>Having WCU of GSI greater than that of Main table helps solve the problem</li></ul></li><li><p>LSI</p><ul><li>Since this is created at the time of table creation, we can&rsquo;t do much about it</li><li>RCU and WCU of the LSI remains same as the table for which it&rsquo;s created</li></ul></li></ul></li><li><p>DyanamoDB concurrency</p><ul><li>DynamoDB has conditional update/delete feature, with which we can check if the item that has to be updated passes the given conditions, i.e the item hasn&rsquo;t changed</li><li>With which DynamoDB is optimistic locking or concurrency database</li></ul></li><li><p>DynamoDB DAX</p><ul><li>Cache for DynamoDB</li><li>Write operation goes through DAX and then to the DynamoDB</li><li>For read operation there is only micro second latency if DAX is used</li><li>5 mins TTL is default setting for cache, but, can be changed</li><li>DAX cluster supports upto 10 nodes and multi AZ as well</li><li>Supports encryption</li></ul></li><li><p>DynamoDB Streams</p><ul><li>Using this, we can track the changes in our DynamoDB</li><li>Can be read by AWS Lambda, EC2 instances to do different operations</li><li>But, we have the option to choose what goes into the database<ul><li>KEYS_ONLY- Only key attributes of the modified item</li><li>NEW_IMAGE- Entire item, after it was modified</li><li>OLD_IMAGE- New item, after modification</li><li>NEW_AND_OLD_IMAGE- Both the items(expensive but helpful)</li></ul></li><li>Data only stays for 24 hours in the Streams</li><li>Records are not retroactively populated- only after the stream is enabled, it&rsquo;s populated</li><li>Streams and Lamda<ul><li>Define event-source mappings</li><li>Have appropriate permissions for the Lambda function</li><li>The function is invoked synchronously</li><li>For this, enable the streams from the table, enable trigger from the triggers section in the table itself and create a Lambda function for reading the data from the streams. Make sure <em>LambdaDynamoDBExecutionRole</em> policy is added to the role</li></ul></li></ul></li><li><p>DynamoDB TTL</p><ul><li>Deleting an item from DynamoDB after a give time</li><li>By default it&rsquo;s disabled</li><li>A column is used, based on it&rsquo;s value, expiration condition is evaluated</li><li>Due to TTL, items in the GSI and LSI also gets deleted</li><li>But we can use Streams to recover expired items, if needed</li><li>The expired item stays for upto 48 hours in the DB</li></ul></li><li><p>DynamoDB CLI</p><ul><li>Projection<pre><code class="language-shell=" data-lang="shell=">aws dynamodb scan --table-name chiras_dynamo_learning \
--projection-expression &quot;id,priority&quot; \
--region ap-south-1
</code></pre></li><li>Filter<pre><code class="language-shell=" data-lang="shell=">aws dynamodb scan --table-name chiras_dynamo_learning \
--projection-expression &quot;id,priority&quot; \
 --filter-expression &quot;id = :u&quot; --expression-attribute-values '{ &quot;:u&quot;: {&quot;N&quot;:&quot;1&quot;}}' \
--region ap-south-1
</code></pre></li><li>Page size<ul><li><pre><code class="language-shell=" data-lang="shell=">  aws dynamodb scan --table-name chiras_dynamo_learning \
  --region ap-south-1
</code></pre>Does one API call</li><li><pre><code class="language-shell=" data-lang="shell=">  aws dynamodb scan --table-name chiras_dynamo_learning \
  --region ap-south-1 --page-size 1
</code></pre>One API call per item</li><li><pre><code class="language-shell=" data-lang="shell=">  aws dynamodb scan --table-name chiras_dynamo_learning \
  --region ap-south-1 --max-items 1
</code></pre></li><li><pre><code class="language-shell=" data-lang="shell=">  aws dynamodb scan --table-name chiras_dynamo_learning \
  --region ap-south-1 --max-items 1 --starting-token eyJFeGNsdXNpdmVTdGFydEtleSI6IG51bGwsICJib3RvX3RydW5jYXRlX2Ftb3VudCI6IDF9
</code></pre></li></ul></li></ul></li><li><p>Copying table options</p><ul><li>Through code</li><li>Using AWS DataPipeline</li><li>Backup and restore to new table</li></ul></li><li><p>DDB Security</p><ul><li>Uses IAM roles to control access and use VPC for availablity</li><li>KMS, SSL/TLS security for rest and in-flight respectively</li></ul></li></ul></div><div class=btn-improve-page><a href=https://github.com/chiranthans23/chiranthans23.github.io/edit/master/content/posts/aws/aws-dynamodb/index.md><i class="fas fa-code-branch"></i>Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/ai/stress-analysis-social-media/ class="btn btn-outline-info"><span><i class="fas fa-chevron-circle-left"></i>Prev</span><br><span>Stress analysis on Social media</span></a></div><div class="col-md-6 next-article"><a href=/posts/general/stay-strong/ class="btn btn-outline-info"><span>Next <i class="fas fa-chevron-circle-right"></i></span><br><span>Staying strong in life</span></a></div></div><hr></div></div></div></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#primary-key>Primary key</a></li><li><a href=#rcu-and-wcu-throughput>RCU and WCU throughput</a></li><li><a href=#dynamodb-basic-apis>DynamoDB basic APIs</a></li><li><a href=#gsi-and-lsi-in-dynamodb>GSI and LSI in DynamoDB</a></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=#about>About</a></li><li class=nav-item><a class=smooth-scroll href=#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=#projects>Projects</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>chiranthans23@gmail.com</span></li><li><span>Phone:</span> <span>+919535179196</span></li></ul></div></div></div><hr></footer><script src=/js/jquery-3.4.1.min.js></script><script src=/js/popper.min.js></script><script src=/js/bootstrap.min.js></script><script src=/js/navbar.js></script><script src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>